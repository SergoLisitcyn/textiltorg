<?php
if (!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED !== true) die();

$obBitrixMarket = new BitrixMarket(REGION, HANDLER, $arHandler);

$arSectionsXml = $obBitrixMarket->GetSectionsXml();
$arrTargetSku = array(100293,11071,97817,97822,97782,100294,100295,11424,97821,97820,97819,101080,97785,97784,100728,12670,100273,100972,100282,100517,12498,12613,12616,12553,12512,101336,101098,100279,11781,11030,12136,11788,11787,12330,10065,11777,100512,97593,101122,101085,101084,10496,100499,12144,99496,12021,10365,10467,10469,97885,10277,10280,12534,97904,97906,97902,101090,101092,10432,12535,97893,97892,10282,97888,11573,11572,11574,11576,11575,10070,12216,12217,10468,99523,100919,100882,100881,99524,100710,100711,100712,100713,100714,100715,100704,100719,100720,100716,100717,100718,100877,100880,100878,100879,100205,99525,100416,100419,100305,99513,99530,99531,99529,100201,100200,100202,99526,99528,99527,100199,100198,101410,101399,11676,11645,11648,11780,11639,11640,11641,11651,11653,10639,10643,10644,10642,10589,11677,100706,100707,100708,100723,100724,100722,100721,12288,100705,11633,11635,11638,100417,100420,100421,100418,10969,10482,10988,10478,10987,10479,10494,10495,10483,10487,100533,11661,100372,100326,100323,100333,100327,10488,10986,10480,10985,11026,100928,100926,100927,100929,12545,12544,100786,100207,99512,99509,99511,12540,99510,99507,99508,12539,12532,100931,100932,100930,100939,10471,11672,10049,10474,11029,12177,100351,100384,100369,100387,100370,100383,100857,100858,100859,100860,10375,10370,10371,100544,100545,101132,101134,11239,11244,11247,11152,11310,11243,11308,11309,100549,100548,100547,100546,100552,101400,100395,100396,11567,11569,100392,100401,100400,11631,11022,12184,12183,12536,100404,100403,100788,100347,100393,100398,100394,100397,100402,100359,100365,100375,100373,100364,100362,100352,100353,10407,10408,12499,12258,12237,11660,99517,99516,100376,99520,99519,99514,100350,99518,11562,101209,11304,10638,10631,100377,99522,11305,12538,100792,100793,100787,100883,100884,100887,100204,100206,100412,100415,11671,11021,10637,10635,10636,10632,10633,10634,10592,100334,100917,100378,100408,100410,100413,100411,100406,10591,100485,100486,100940,100941,100942,100390,97577,11770,100332,100108,100933,10498,10152,100934,100935,100936,100937,100938,10374,11775,100386,99504,10073,100358,101111,101112,101113,101097,100218,11237,100750,100749,101421,101129,101131,101401,100147,100149,100148,100385,100388,100830,10973,10974,11210,11655,14990,11668,100285,11220,11221,12552,11667,11665,100828,100829,101376,100862,100864,100863,100865,99494,100867,100331,100328,11156,97846,97848,97847,101303,11611,10970,11602,10971,10972,100270,100271,100272,100853,12232,10313,11225,11226,11224,10501,11227,12261,10500,10499,101159,101160,101161,101120,101408,101409,97852,12191,12192,10275,100296,11063,11577,11052,10305,100300,99500,100298,100299,100217,12564,100775,100774,100977,100975,100976,10764,12370,12282,12281,12618,12617,12376,100827,101412,11076,12265,100531,100281,100297,12517,12518,12519,12520,12521,12522,12523,12524,12525,12526,12527,12528,12529,12530,12531,100280,100278,100277,101394,101393,101390,101392,100969,97908,97682,100211,100214,100284,100215,100503,12501,100274,97878,97877,97907,100301,100266,100265,12514,12515,12516,12561,12562,100208,100773,100776,12608,12607,12609,12605,100522,12603,100727,12604,97840,97841,97842,100509,101175,101407,101119,101121,10052,12497,11042,11043,11679,11680,11681,12326,11041,12262,10136,10619,11694,11073,11600,10138,12294,10620,11241,10140,11607,11248,11245,11730,11657,11004,11069,11558,11050,10295,10296,11296,12389,10299,10300,10301,10302,11298,11300,11301,10304,11003,100856,11604,10360,10834,10835,10836,99498,99497,12308,12310,12316,12214,10837,10838,10839,10840,10179,99501,99502,100777,10413,10414,10415,12478);
$arElementsXml = $obBitrixMarket->GetElementsXmlGoods(true, $arrTargetSku);

// echo "<pre>";
// var_dump($arElementsXml);
// die;

$arShopXML = array(
    "name" => BitrixMarket::SHOP_NAME,
    "company" => BitrixMarket::SHOP_COMPANY,
    "url" => $obBitrixMarket->GetFullShopUrl(false),
    "currencies" => array(
        "currency" => array(
            "@id" => $obBitrixMarket->GetCurrency(),
            "@rate" => "1"
        )
    ),
    "categories" => array(
        "category" => $arSectionsXml
    ),
    "delivery-options" => array(
        "option" => array(
            "@cost" => BitrixMarket::DEFAULT_PRICE_DELIVERY,
            "@days" => BitrixMarket::DEFAULT_DAYS_DELIVERY,
        )
    )
);

if (!empty($arHandler["CPA"]))
{
    $arShopXML["cpa"] = "1";
}

$arShopXML["offers"] = array(
    "offer" => $arElementsXml
);

$arXml = array(
    "yml_catalog" => array(
        "@date" => date("Y-m-d H:i"),
        "shop" => $arShopXML
    )
);

header('Content-type: text/xml');
$xml = new ArrayToXML();
print $xml->buildXML($arXml, false);