<?php
if (!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED !== true) die();

$obBitrixMarket = new BitrixMarket(REGION, HANDLER, $arHandler);

//Швейные машины - 19
//Оверлоки - 20
//Вышивальные машины - 23
//Швейно-вышивальные машины - 24
//Вязальные машины - 83

$obBitrixMarket->GetSectionsXml();
$arrTargetCategory = array(20,19,83,24,23,977,1001,1023,1030);
$arrTargetProducts = array(456,474,482,498,519,584,595,597,613,614,647,728,737,738,824,914,915,921,1005,1493,1499,1597,1598,1599,1601,1602,1705,1745,2171,2176,2177,2184,2216,2224,2575,2613,2632,2672,2702,2720,2722,2770,2814,2816,2825,2931,2983,2994,3000,3002,3006,3073,3074,3112,3125,9217,9220,10902,10903,11619,11672,11686,11710,11712,11713,11912,11916,11923,11938,11948,11960,11961,11965,12165,12167,12284,12291,12362,12364,12567,12807,12808,12809,12810,12811,12812,12814,12815,12816,12817,12818,12819,12820,12821,12822,12823,12860,12878,341000002,487000002,488000002,498000002,11365000001,11449000001,11454000001,11458000001,11463000001,11464000001,63129000001,63243000001,65982000001,66080000001,66142000001,66660000001,66661000001,66681000001,66886000001,66889000001,66890000001,66951000001,69894000001,70625000001,70643000001,70660000001,70679000001,70708000001,70752000001,70775000001,70796000001,70800000001,70801000001,70841000001,70860000001,70863000001,70888000001,70889000001,70890000001,70891000001,70892000001,70908000001,70910000001,70911000001,70912000001,70913000001,70914000001,70929000001,70930000001,70944000001,70945000001,70984000001,71897000001,71973000001,71988000001,71990000001,71991000001,71992000001,71995000001,71998000001,72043000001,72062000001,72077000001,72408000001);
$arElementsXml = $obBitrixMarket->GetElementsXmlGoogleMS($arrTargetCategory, $arrTargetProducts);

foreach($arElementsXml as &$item){
    foreach($arElementsXml as &$check){
        if($item['title'] == $check['title'] . ' во'){
            $check['g:price'] = $item['g:price'];
            $check['link'] = $item['link'];
            $item = '';
        }
    }
}

$arXml = array(
    "feed" => array(
        "@xmlns" => "http://www.w3.org/2005/Atom",
        "@xmlns:g" => "http://base.google.com/ns/1.0",
        "title" => BitrixMarket::SHOP_NAME,
        "link" => array(
            "@rel" => "self",
            "%" => $obBitrixMarket->GetFullShopUrl(false),
        ),
        "updated" => date("Y-m-d\TH:i:s\Z"),
        "entry" => $arElementsXml
    )
);

header('Content-type: text/xml');
$xml = new ArrayToXML();
print $xml->buildXML($arXml, false);