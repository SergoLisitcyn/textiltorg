(function(e){BX.namespace("BX.Sender");if(BX.Sender.Letter){return}var t=BX.Sender.Page;var i=BX.Sender.Helper;function o(){this.context=null}o.prototype.init=function(e){this.context=BX(e.containerId);this.actionUri=e.actionUri;this.isFrame=e.isFrame||false;this.prettyDateFormat=e.prettyDateFormat;this.mess=e.mess;this.templateChangeButton=BX("SENDER_LETTER_BUTTON_CHANGE");this.selectorNode=i.getNode("template-selector",this.context);this.editorNode=i.getNode("letter-editor",this.context);this.titleNode=i.getNode("letter-title",this.context);this.buttonsNode=i.getNode("letter-buttons",this.context);this.templateNameNode=i.getNode("template-name",this.editorNode);this.templateTypeNode=i.getNode("template-type",this.editorNode);this.templateIdNode=i.getNode("template-id",this.editorNode);if(BX.Sender.Template&&BX.Sender.Template.Selector){var o=BX.Sender.Template.Selector;BX.addCustomEvent(o,o.events.templateSelect,this.onTemplateSelect.bind(this));BX.addCustomEvent(o,o.events.selectorClose,this.closeTemplateSelector.bind(this))}if(this.templateChangeButton){BX.bind(this.templateChangeButton,"click",this.showTemplateSelector.bind(this))}if(this.isFrame){i.titleEditor.init({dataNode:this.titleNode,disabled:e.isTemplateShowed,defaultTitle:this.getPatternTitle(this.mess.name)})}t.initButtons()};o.prototype.getPatternTitle=function(e){return i.replace(this.mess.patternTitle,{name:e,date:BX.date.format(this.prettyDateFormat)})};o.prototype.onTemplateSelect=function(t){if(this.templateNameNode){this.templateNameNode.textContent=t.name}if(this.templateTypeNode){this.templateTypeNode.value=t.type}if(this.templateIdNode){this.templateIdNode.value=t.code}this.titleNode.value=this.getPatternTitle(t.name);BX.fireEvent(this.titleNode,"change");this.closeTemplateSelector();e.scrollTo(0,0)};o.prototype.closeTemplateSelector=function(){this.changeDisplayingTemplateSelector(false)};o.prototype.showTemplateSelector=function(){this.changeDisplayingTemplateSelector(true)};o.prototype.changeDisplayingTemplateSelector=function(e){var t="bx-sender-letter-show";var o="bx-sender-letter-hide";i.changeClass(this.selectorNode,t,e);i.changeClass(this.selectorNode,o,!e);i.changeClass(this.editorNode,t,!e);i.changeClass(this.editorNode,o,e);i.changeDisplay(this.templateChangeButton,!e);i.changeDisplay(this.buttonsNode,!e);e?i.titleEditor.disable():i.titleEditor.enable()};BX.Sender.Letter=new o})(window);